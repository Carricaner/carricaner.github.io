[{"categories":["Design Pattern"],"content":"è®“æˆ‘å˜—è©¦ç”¨ Java ä¾†å¯¦ä½œç‹€æ…‹æ¨¡å¼å§ï¼","date":"2022-08-11","objectID":"/state-machine/","tags":["Java","design","pattern","state","machine","transition"],"title":"é€²å…¥è¨­è¨ˆæ¨¡å¼çš„ä¸–ç•Œ -- ç‹€æ…‹æ©Ÿæ¨¡å¼ ( State pattern )","uri":"/state-machine/"},{"categories":["Design Pattern"],"content":"å‰è¨€ ã€Œç‹€æ…‹æ©Ÿæ¨¡å¼ã€( State Pattern ) æ˜¯çœ¾å¤šè¨­è¨ˆæ¨¡å¼ä¸­çš„ä¸€ç¨®ï¼Œä¸»è¦æ˜¯ç”¨ä¾†è™•ç†ä¸€ç¨®ç‰©ä»¶å¯èƒ½ä¾ç…§ä¸åŒçš„ç‹€æ…‹è€Œæœ‰ä¸åŒè¡Œç‚ºçš„æƒ…æ³ã€‚ å¯ä»¥æ‡‰ç”¨çš„å ´æ™¯æœ‰éŒ„éŸ³æ©Ÿã€ç´…ç¶ ç‡ˆç­‰ã€‚è‹¥æ˜¯å•†æ¥­æ–¹é¢çš„æ‡‰ç”¨è©±ï¼Œå¦‚åŒ…è£¹é‹é€ã€æ–‡ä»¶å‚³ç°½ç­‰ã€‚ æœ¬æ–‡å°±ä»¥å…¬å¸è£¡é¢æœƒå‡ºç¾çš„ã€Œå‚³ç°½ã€ä¾†ç•¶ä½œç‹€æ…‹æ¨¡å¼çš„æ‡‰ç”¨å ´æ™¯ã€‚ Photo by Signature Pro in Unsplash ","date":"2022-08-11","objectID":"/state-machine/:1:0","tags":["Java","design","pattern","state","machine","transition"],"title":"é€²å…¥è¨­è¨ˆæ¨¡å¼çš„ä¸–ç•Œ -- ç‹€æ…‹æ©Ÿæ¨¡å¼ ( State pattern )","uri":"/state-machine/"},{"categories":["Design Pattern"],"content":"æœ¬æ–‡ ","date":"2022-08-11","objectID":"/state-machine/:2:0","tags":["Java","design","pattern","state","machine","transition"],"title":"é€²å…¥è¨­è¨ˆæ¨¡å¼çš„ä¸–ç•Œ -- ç‹€æ…‹æ©Ÿæ¨¡å¼ ( State pattern )","uri":"/state-machine/"},{"categories":["Design Pattern"],"content":"å ´æ™¯ä¸€ï¼šç°¡å–®çš„å‚³ç°½ç³»çµ± å‡è¨­ç¾åœ¨æœ‰ä¸€é–“æ–°å‰µå…¬å¸å‰›æˆç«‹ä¸€å¹´ï¼Œå…§éƒ¨è¨­è¨ˆå‡ºå¦‚ä¸‹åœ–çš„å‚³ç°½æµç¨‹ï¼š æˆ‘æº–å‚™äº†ä»¥ä¸‹å¹¾é …æ±è¥¿ä¾†ç¬¦åˆéœ€æ±‚ï¼š ç‹€æ…‹æ©Ÿ ( State Machine ) ç‹€æ…‹ ( State ) ç‹€æ…‹è³‡è¨Š ( StateInfo ) public interface StateMachine { /* Switch to next state */ void nextState(); /* Print current information */ void info(); } public interface State { /* Set next state */ void setNextState(State nextState); /* Switch to \u0026 return next state */ State nextState(); /* Print current state information */ void printStateInfo(); } public class SignatureStateMachine implements StateMachine { private State currentState; public SignatureStateMachine(State currentState) { this.currentState = currentState; } @Override public void nextState() { if (currentState != null) currentState = currentState.nextState(); } @Override public void info() { if (currentState != null) { currentState.printStateInfo(); } else { System.out.println(\"Already approved!\"); } } } public class SignatureState implements State { private State nextState; private StateInfo info; public SignatureState(StateInfo info) { this.info = info; } @Override public void setNextState(State nextState) { this.nextState = nextState; } @Override public State nextState() { return nextState; } @Override public void printStateInfo() { System.out.println(\"Now, the state is \" + info.getInfo()); } } public enum StateInfo { DRAFT(\"Draft\"), WATING_FOR_BOSS(\"Waiting for boss\"), APPROVED(\"Approved\"); private String info; StateInfo(String info) { this.info = info; } public String getInfo() { return info; } } æ¥è‘—ï¼Œæˆ‘å€‘ä¾†æ“ä½œé€™æ¬¡çš„ç‹€æ…‹è½‰ç§»ã€‚ public class SignatureDemo { public static void main(String[] args) { State draftState = new SignatureState(StateInfo.DRAFT); State waitingForBossState = new SignatureState(StateInfo.WATING_FOR_BOSS); State approvedState = new SignatureState(StateInfo.APPROVED); draftState.setNextState(waitingForBossState); waitingForBossState.setNextState(approvedState); approvedState.setNextState(null); StateMachine signSystem = new SignatureStateMachine(draftState); signSystem.info(); // \"Now, the state is Draft\" signSystem.nextState(); signSystem.info(); // \"Now, the state is Waiting for boss\" signSystem.nextState(); signSystem.info(); // \"Now, the state is Approved\" signSystem.nextState(); signSystem.info(); // \"Already approved!\" signSystem.nextState(); signSystem.info(); // \"Already approved!\" } } ","date":"2022-08-11","objectID":"/state-machine/:2:1","tags":["Java","design","pattern","state","machine","transition"],"title":"é€²å…¥è¨­è¨ˆæ¨¡å¼çš„ä¸–ç•Œ -- ç‹€æ…‹æ©Ÿæ¨¡å¼ ( State pattern )","uri":"/state-machine/"},{"categories":["Design Pattern"],"content":"å ´æ™¯äºŒï¼šæ¼¸æ¼¸è¤‡é›œçš„å‚³ç°½ç³»çµ± ä¸Šå€‹ä¾‹å­æ¯”è¼ƒç°¡å–®ï¼Œç¾åœ¨é–‹å§‹åŠ å…¥ä¸€äº›ç¾å¯¦ä¸Šå¯èƒ½æœƒé‡åˆ°çš„å•é¡Œï¼Œä¸¦ä¸”èª¿æ•´æˆ‘å€‘çš„ç¨‹å¼ç¢¼ä¾†ç¬¦åˆéœ€æ±‚ã€‚åŠ å…¥è€ƒæ…®çš„é …ç›®å¦‚ä¸‹ï¼š å…¬å¸é›‡ç”¨ä¸€ä½éƒ¨é–€ä¸»ç®¡ï¼Œæ–‡ä»¶ç°½æ ¸å¿…é ˆä¾åºç°½åˆã€‚ éƒ¨é–€ä¸»ç®¡èˆ‡è€é—†å¯ä»¥é€€å›æ–‡ä»¶ï¼Œæ–‡ä»¶å‚³å›ä¸Šä¸€ç‹€æ…‹ã€‚ æ–°çš„å‚³ç°½æµç¨‹ï¼š é€™æ¬¡çš„æƒ…å¢ƒä¸å†æ˜¯åªæœ‰å–®ä¸€çš„ç‹€æ…‹è½‰ç§»ï¼Œå› æ­¤æˆ‘å€‘æ–°å»ºç«‹ç°½ç½²å‹•ä½œ ( Sign action ) ä¾†ç•¶ä½œç‹€æ…‹è½‰ç§»çš„åˆ¤æ–·æ¨™æº–ã€‚ ç°½ç½²å‹•ä½œ ( Sign action ): public enum SignAction { SIGN(1), REJECT(2); private Integer code; SignAction(Integer code) { this.code = code; } } æˆ‘å€‘æ²¿ç”¨ä¸Šé¢çš„ç‹€æ…‹æ©Ÿ ( StateMachine ) ä»‹é¢ï¼Œä½†æ˜¯æ”¹å¯«ç‹€æ…‹ ( State ) ä»‹é¢ï¼Œä¸¦ä¸”é‡æ–°å¯¦ä½œå®ƒå€‘ã€‚ é‡æ–°å®šç¾©çš„ç‹€æ…‹ä»‹é¢å¦‚ä¸‹ï¼š public interface State { /* Register a next state */ void registerNextState(SignAction action, State nextState); /* Switch to \u0026 return next state */ State nextState(SignAction action); /* Print current state information */ void printStateInfo(); } ç‹€æ…‹æ©Ÿ ( State Machine ) public class SignatureStateMachine implements StateMachine { private State currentState; public SignatureStateMachine(State currentState) { this.currentState = currentState; } @Override public void nextState(SignAction action) { if (currentState != null) currentState = currentState.nextState(action); } @Override public void info() { if (currentState != null) { currentState.printStateInfo(); } else { System.out.println(\"Already approved!\"); } } /* The static method to generate a custom signature system */ public static SignatureStateMachine generateSignatureSystem() { State draftState = new SignatureState(StateInfo.DRAFT); State waitingForLeaderState = new SignatureState(StateInfo.WATING_FOR_LEADER); State waitingForBossState = new SignatureState(StateInfo.WATING_FOR_BOSS); State approvedState = new SignatureState(StateInfo.APPROVED); draftState.registerNextState(SignAction.SIGN, waitingForLeaderState); waitingForLeaderState.registerNextState(SignAction.SIGN, waitingForBossState); waitingForLeaderState.registerNextState(SignAction.REJECT, draftState); waitingForBossState.registerNextState(SignAction.SIGN, approvedState); waitingForBossState.registerNextState(SignAction.REJECT, waitingForLeaderState); return new SignatureStateMachine(draftState); } } ç‹€æ…‹ ( State ) public class SignatureState implements State{ private Map\u003cSignAction, State\u003e map = new EnumMap\u003c\u003e(SignAction.class); private StateInfo info; public SignatureState(StateInfo info) { this.info = info; } @Override public void registerNextState(SignAction action, State nextState) { map.put(action, nextState); } @Override public State nextState(SignAction action) { if (map.containsKey(action)) { return map.get(action); } else { throw new StateError.NoSuchStateException(); } } @Override public void printStateInfo() { System.out.println(\"Now, the state is \" + info.getInfo() + \".\"); } } æ­¤å¤–ï¼Œæˆ‘å€‘æŠŠç‹€æ…‹æ©Ÿç›´æ¥å°è£åœ¨æ–‡ä»¶ ( File ) å…§éƒ¨ï¼Œè®“æ“ä½œçš„äººå¯ä»¥åªéœ€é‡å°æ–‡ä»¶é€²è¡Œæ“ä½œï¼Œä¸ç”¨çŸ¥é“å…§éƒ¨çš„ç‹€æ…‹å¯¦éš›ä¸Šæ˜¯æ€éº¼é‹ä½œã€‚ æ–‡ä»¶ ( File ) public class File { /* The file's content */ private String content; /* Whether the file is submitted. */ private boolean submitted = false; /* The map to store role \u0026 password pairs. */ private Map\u003cString, String\u003e roleToTokenMap = Map.ofEntries( Map.entry(\"Leader\", \"leader-pass-123\"), Map.entry(\"Boss\", \"boss-pass-456\") ); /* Inner state machine */ private SignatureStateMachine stateMachine = SignatureStateMachine.generateSignatureSystem(); public File(String content) { this.content = content; } /* Display the file's state information */ public void stateInfo() { stateMachine.info(); } /* To sign the file */ public void sign(String role, String password, SignAction action) { if (!submitted) throw new StateError.NotSubmittedException(); if (roleToTokenMap.containsKey(role) \u0026\u0026 roleToTokenMap.get(role).equals(password)) { stateMachine.nextState(action); if (role.equals(\"Leader\") \u0026\u0026 SignAction.REJECT.equals(action)) { submitted = false; } } } /* To submit the file */ public void submit() { if (!submitted) { stateMachine.nextState(SignAction.SIGN); submitted = true; } else { throw new StateError.AlreadySubmittedException(); } } } ç‹€æ…‹è½‰ç§»å¦‚ä¸‹ï¼š public class SignatureDemo2 { public static void main(String[] args) { String fileContent = \"Promotion request.\"; File newFile = new File(fileContent); newFile.stateInfo(); // \"Now, the state is Draft.\" newFile.submit(); newFile.stateInf","date":"2022-08-11","objectID":"/state-machine/:2:2","tags":["Java","design","pattern","state","machine","transition"],"title":"é€²å…¥è¨­è¨ˆæ¨¡å¼çš„ä¸–ç•Œ -- ç‹€æ…‹æ©Ÿæ¨¡å¼ ( State pattern )","uri":"/state-machine/"},{"categories":["Design Pattern"],"content":"æ›´å¤šè¤‡é›œçš„å ´æ™¯ çœŸæ­£åœ¨è™•ç†å…¬å¸å…§éƒ¨çš„æ¥­å‹™é‚è¼¯çš„æ™‚å€™ï¼Œè¤‡é›œåº¦å¾€å¾€æ²’æœ‰åƒä¸Šé¢å…©å€‹ä¾‹å­ä¸€æ¨£ç°¡å–®ï¼Œå¥½æ¯”ä¸‹é¢å‚³ç°½çš„å ´æ™¯ï¼š åœ¨è™•ç†è¤‡é›œå ´æ™¯çš„æ™‚å€™ï¼Œé‚„å¯ä»¥è€ƒæ…®ä»¥ä¸‹å¹¾é»ï¼Œè®“ç‹€æ…‹æ¨¡å¼æ›´å‹•æ…‹ ( ç•¶ç„¶ä¹Ÿå°±æ›´è¤‡é›œâ€¦ ğŸ˜… ) æŠ½è±¡åŒ–è½‰æ›éç¨‹ ( Transition )ã€‚ å°è£ç‹€æ…‹æ©Ÿ ( State Machine ) åˆ°æœƒæ”¹è®Šç‹€æ…‹çš„ç‰©ä»¶ç•¶ä¸­ã€‚ ä½¿ç”¨åˆ—èˆ‰ ( Enumerate ) æ–¹å¼ä¾†å®šç¾©ç‹€æ…‹è³‡è¨Š ( State Information )ã€è½‰æ›éç¨‹ ( Transition ) ç­‰ã€‚ é™¤äº†å¯ä»¥è½‰æ›çš„ç‹€æ…‹ä¹‹å¤–ï¼Œä¹Ÿç´€éŒ„ä¸Šä¸€å€‹ç‹€æ…‹ã€‚ æœ‰æ©Ÿæœƒè½‰æ›å¤±æ•—çš„è©±ï¼ŒåŠ å…¥å›æ»¾ ( Rollback )çš„è½‰æ›ã€‚ ç•¶ç„¶â€¦é€™ç¯‡æ–‡ç« å°±ä¸å¯«å‡ºå¦‚ä½•è™•ç†é€™æ¨£çš„å ´æ™¯å•¦! ğŸ˜‰ ","date":"2022-08-11","objectID":"/state-machine/:2:3","tags":["Java","design","pattern","state","machine","transition"],"title":"é€²å…¥è¨­è¨ˆæ¨¡å¼çš„ä¸–ç•Œ -- ç‹€æ…‹æ©Ÿæ¨¡å¼ ( State pattern )","uri":"/state-machine/"},{"categories":["Design Pattern"],"content":"ç¸½çµ ç‹€æ…‹æ¨¡å¼ ( State Machine ) ä¸»è¦æ˜¯ç”¨ä¾†è™•ç†ä¸€ç¨®ç‰©ä»¶å¯èƒ½ä¾ç…§ä¸åŒçš„ç‹€æ…‹è€Œæœ‰ä¸åŒè¡Œç‚ºçš„æƒ…æ³ã€‚ ç‹€æ…‹æ¨¡å¼å¯ä»¥æœ‰ä¸åŒçš„å¯¦ä½œæ–¹å¼ï¼Œä½†æ˜¯æ ¸å¿ƒç²¾ç¥åœ¨æ–¼è™•ç†ç‹€æ…‹èˆ‡è½‰ç§»ä¹‹é–“çš„é—œä¿‚ã€‚ è¨­è¨ˆéç¨‹ä¸­ï¼Œå¯èƒ½æ¶‰åŠæœ‰é™ç‹€æ…‹æ©Ÿ ( Finite-State Machine ) æ¨¡å‹ã€‚ å¸¸è¦‹çš„ç”Ÿæ´»ä¾‹å­æœ‰ç´…ç¶ ç‡ˆã€å„å¼é›»å™¨ç­‰ç­‰ã€‚å•†æ¥­æ‡‰ç”¨çš„è©±å¥½æ¯”å‚³ç°½ç³»çµ±ã€åŒ…è£¹é…é€ç³»çµ±ã€é›»å­ä¸‹å–®ç³»çµ±ç­‰ç­‰ã€‚ è‹¥é¢å°æ¯”è¼ƒè¤‡é›œçš„å ´æ™¯ï¼ŒJava çš„ä½¿ç”¨è€…å¯ä»¥é¸æ“‡å¥—ç”¨ Spring Statemachine ã€‚ ","date":"2022-08-11","objectID":"/state-machine/:3:0","tags":["Java","design","pattern","state","machine","transition"],"title":"é€²å…¥è¨­è¨ˆæ¨¡å¼çš„ä¸–ç•Œ -- ç‹€æ…‹æ©Ÿæ¨¡å¼ ( State pattern )","uri":"/state-machine/"},{"categories":["Design Pattern"],"content":"åƒè€ƒ State Machines: Components, Representations, Applications State Design Pattern in Java Validating Input with Finite Automata in Java A Guide to the Spring State Machine Project Implementing Simple State Machines with Java Enums Simple State Machines in Java ","date":"2022-08-11","objectID":"/state-machine/:4:0","tags":["Java","design","pattern","state","machine","transition"],"title":"é€²å…¥è¨­è¨ˆæ¨¡å¼çš„ä¸–ç•Œ -- ç‹€æ…‹æ©Ÿæ¨¡å¼ ( State pattern )","uri":"/state-machine/"},{"categories":["Algorithm"],"content":"ç•¶ä¸€å€‹äº¤æ˜“åŒ…å«äº†å¤šå€‹éœ€è¦é€éç¶²è·¯æºé€šçš„ç¯€é»æ™‚ï¼Œæˆ‘å€‘è©²å¦‚ä½•è™•ç†å‘¢ï¼Ÿ","date":"2022-02-28","objectID":"/two-pc-intro/","tags":["distribution","algorithm","commit","abort","rollback","consistency"],"title":"è·¨ä¼ºæœå™¨äº¤æ˜“è™•ç† â€” èªè­˜äºŒéšæ®µæäº¤ ( 2PC )","uri":"/two-pc-intro/"},{"categories":["Algorithm"],"content":"å‰è¨€ ç”±æ–¼ç¾ä»£æ–¹ä¾¿çš„ç¶²è·¯ï¼Œä½¿ç”¨è€…é€éæ‰‹æ©Ÿæˆ–é›»è…¦å°±èƒ½å¤ é€²è¡Œå€‹äººåŒ–çš„æ“ä½œã€‚ ç•¶ä¸€ä½ä½¿ç”¨è€…é€²è¡Œè½‰å¸³ï¼Œç›®çš„æ˜¯å¾ A å¸³æˆ¶è½‰åˆ° B å¸³æˆ¶ï¼Œé–‹ç™¼è€…åœ¨èƒŒå¾Œæ˜¯å¦‚ä½•è™•ç†çš„å‘¢ï¼Ÿ é€™ç¯‡æ–‡ç« ä¸»è¦æœƒåˆ—èˆ‰ä¸¦è¨è«–é€™ç¨®æƒ…å¢ƒä¸‹æœƒé‡åˆ°çš„ä¸€äº›ç‹€æ³ã€‚ é€²å…¥æœ¬æ–‡å‰çš„å¹¾é»äº‹é …ï¼š æœ¬æ–‡åªåˆ—èˆ‰å¹¾å€‹ç¨®ç‹€æ³ä¾†åšã€ æ¦‚æ‹¬æ€§ ã€çš„è¨è«–ï¼Œä¸æ¶‰åŠå¯¦ä½œã€‚ é‡å°è·¨ä¼ºæœå™¨ ( æˆ–åˆ†æ•£å¼ ) çš„äº‹å‹™è™•ç†é‚„æœ‰å…¶ä»–ç¨®æ–¹å¼ï¼Œæœ¬æ–‡ä¸»è¦é‡å°äºŒéšæ®µæäº¤çš„éƒ¨åˆ†è¨è«–ã€‚ æ–‡ä¸­æ¯å€‹ç¯€é» ( ä¼ºæœå™¨ ) éƒ½åªæœƒä½¿ç”¨ä¸€å€‹è³‡æ–™åº«å­˜æ”¾è³‡æ–™ã€‚ Photo by Eduardo Soares in Unsplash ","date":"2022-02-28","objectID":"/two-pc-intro/:1:0","tags":["distribution","algorithm","commit","abort","rollback","consistency"],"title":"è·¨ä¼ºæœå™¨äº¤æ˜“è™•ç† â€” èªè­˜äºŒéšæ®µæäº¤ ( 2PC )","uri":"/two-pc-intro/"},{"categories":["Algorithm"],"content":"æœ¬æ–‡ å†è¨è«–æƒ…å¢ƒå•é¡Œä¹‹å‰ï¼Œæˆ‘å€‘å…ˆä¾†äº†è§£ä¸‹é¢å…©å€‹æ¦‚å¿µ: äº¤æ˜“ ( Transaction ) äºŒéšæ®µæäº¤ ( two-phase commit, 2PC ) ","date":"2022-02-28","objectID":"/two-pc-intro/:2:0","tags":["distribution","algorithm","commit","abort","rollback","consistency"],"title":"è·¨ä¼ºæœå™¨äº¤æ˜“è™•ç† â€” èªè­˜äºŒéšæ®µæäº¤ ( 2PC )","uri":"/two-pc-intro/"},{"categories":["Algorithm"],"content":"äº¤æ˜“ ( Transaction ) äº¤æ˜“æ˜¯æŒ‡è¤‡æ•¸å€‹å°è³‡æ–™åº«çš„æ“ä½œåŒ…æˆçš„ä¸€å€‹é‚è¼¯å–®ä½ï¼Œä¸¦ä¸”åŒæ™‚éœ€è¦å…·å‚™ä»¥ä¸‹å…©é»ç‰¹å¾µï¼š åŒ…å«çš„è¤‡æ•¸å€‹è³‡æ–™åº«æ“ä½œå¿…é ˆæ˜¯ä¸€èµ·æˆåŠŸåŸ·è¡Œ ( commit ) æˆ–æ˜¯ä¸€èµ·ä¸åŸ·è¡Œ ( rollback )ã€‚ æ¯å€‹äº‹å‹™ä¹‹é–“ä¸æœƒäº’ç›¸å¹²æ“¾ ( Isolation )ã€‚ ","date":"2022-02-28","objectID":"/two-pc-intro/:2:1","tags":["distribution","algorithm","commit","abort","rollback","consistency"],"title":"è·¨ä¼ºæœå™¨äº¤æ˜“è™•ç† â€” èªè­˜äºŒéšæ®µæäº¤ ( 2PC )","uri":"/two-pc-intro/"},{"categories":["Algorithm"],"content":"äºŒéšæ®µæäº¤ ( two-phase commit, 2PC ) äºŒéšæ®µæäº¤æ˜¯å¯¦ç¾è·¨æœå‹™é–“äº¤æ˜“çš„ä¸€ç¨®æ¼”ç®—æ³• ( æ¥ä¸‹ä¾†éƒ½ä»¥ 2PC ä»£ç¨± )ã€‚ è¨­è¨ˆ 2PC éœ€è¦ä¸€å€‹äº‹å‹™å”èª¿è€… ( transaction coordinator, ç°¡ç¨± TC )ï¼Œå…¶è² è²¬èˆ‡å„å€‹åƒèˆ‡è€… ( cohort ) æºé€šä¾†æ»¿è¶³äº¤æ˜“çš„åŸºæœ¬æ¢ä»¶ã€‚ æ•´å€‹éç¨‹é–“åˆ†ç‚ºå…©å€‹æ­¥é©Ÿï¼šè©¢å• \u0026 æäº¤ã€‚ æµç¨‹ï¼š ä½¿ç”¨è€…å‘ TC æå‡ºäº¤æ˜“éœ€æ±‚ TC è©¢å•å„å€‹ cohorts cohorts é–å®šå„è‡ªçš„è³‡æº \u0026 å›å‚³ Yes TC ä¸‹é” commit ï¼†å›è¦†ä½¿ç”¨è€… OK cohorts åŸ·è¡Œäº¤æ˜“é‚è¼¯ä¸¦å›å‚³ done ç¤ºæ„åœ–ï¼š èˆ‰ä¸€å€‹æœ‰è¶£ä¾‹å­ï¼Œè¥¿æ–¹æ•™å ‚èˆ‰è¾¦å©šç¦®çš„æ™‚å€™ï¼š ç‰§å¸«åˆ†åˆ¥å•æ–°éƒä»¥åŠæ–°å¨˜ï¼šä½ æ˜¯å¦é¡˜æ„â€¦ ä¸ç®¡ç”Ÿè€ç—…æ­»éƒ½â€¦ ? Â å”èª¿è€…è©¢å•åƒèˆ‡è€…å€‘ æ–°éƒæ–°å¨˜åˆ†åˆ¥å›ç­”ï¼šé¡˜æ„ï¼ Â åƒèˆ‡è€…å€‘å›è¦†ç¢ºèªä¸¦ä¸”é–å®šä¸€ç”Ÿè³‡æºï¼ï¼Ÿ ç‰§å¸«ï¼šåœ¨æ­¤å®£ä½ˆ.. æ­£å¼æˆç‚ºå¤«å¦»ï¼ Â å”èª¿è€…æäº¤ ","date":"2022-02-28","objectID":"/two-pc-intro/:2:2","tags":["distribution","algorithm","commit","abort","rollback","consistency"],"title":"è·¨ä¼ºæœå™¨äº¤æ˜“è™•ç† â€” èªè­˜äºŒéšæ®µæäº¤ ( 2PC )","uri":"/two-pc-intro/"},{"categories":["Algorithm"],"content":"æƒ…å¢ƒ ä½¿ç”¨è€…æƒ³è¦å¾ A éŠ€è¡Œå¸³æˆ¶ ( ç°¡ç¨± A å¸³æˆ¶ ) è½‰å¸³ 100 å…ƒåˆ° B éŠ€è¡Œå¸³æˆ¶ ( ç°¡ç¨± B å¸³æˆ¶ )ã€‚ æœ‰å¹¾é»æ³¨æ„ \u0026 å‡è¨­ï¼š åªè€ƒæ…®é¤˜é¡å……è¶³çš„æƒ…æ³ ( A å¸³æˆ¶é¤˜é¡ \u003e 100 å…ƒ ) å‡è¨­ A, B éŠ€è¡Œéƒ½å„è‡ªåªç”¨ä¸€å€‹è³‡æ–™åº«å„²å­˜è³‡æ–™ã€‚ å¿…é ˆæ»¿è¶³äº¤æ˜“çš„åŸºæœ¬åŸå‰‡ã€‚ å‡è¨­æœ‰ä¸€å€‹å”èª¿è€…ç®¡ç†é€™ç­†äº¤æ˜“ ( ç¨±ç‚º TC ) A å¸³æˆ¶ Â cohort A B å¸³æˆ¶ Â cohort B ç›´è§€çš„åšæ³•å°±æ˜¯ï¼š å…ˆå» A å¸³æˆ¶é€²è¡Œæ‰£æ¬¾ 100 å…ƒ å†å» B å¸³æˆ¶é€²è¡Œå­˜æ¬¾ 100 å…ƒ Done! ç­‰ç­‰â€¦ äº‹æƒ…å¥½åƒé€²è¡Œå¾—éæ–¼é †åˆ©â€¦ï¼Ÿ é‚£æ¥ä¸‹ä¾†è¨è«–å¹¾å€‹ç‹€æ³ ç‹€æ³ä¸€ï¼šå¸³æˆ¶ B åœ¨äº¤æ˜“éç¨‹ä¸­å­˜æ¬¾å¤±æ•— æƒ…å¢ƒæœƒæ¼”è®Šæˆ A å¸³æˆ¶å·²ç¶“æ‰£é™¤äº† 100 å…ƒï¼Œä½†æ˜¯ B å¸³æˆ¶å»æ²’æœ‰å­˜åˆ°æ¬¾çš„æƒ…å½¢â€¦ å¥—ç”¨ 2PC çš„è§£æ±ºç¨‹åºï¼š ä½¿ç”¨è€…å‘ TC æå‡ºäº¤æ˜“éœ€æ±‚ TC å‘å¸³æˆ¶ A, B è©¢å•å¯å¦é€²è¡Œäº¤æ˜“ TC æ”¶åˆ°å¸³æˆ¶ B çš„å¤±æ•—å›è¦† TC å‘å¸³æˆ¶ A, B å‚³é€æ”¾æ£„çš„å‘½ä»¤ ( abort ) TC å›å‚³è½‰å¸³å¤±æ•—çš„è¨Šæ¯çµ¦ä½¿ç”¨è€…ã€‚ ç¤ºæ„åœ–å¦‚ä¸‹ï¼š é›–ç„¶äº¤æ˜“å¤±æ•—ï¼Œä½†æ˜¯ç¢ºä¿äº†è·¨æœå‹™é–“è³‡æ–™çš„ä¸€è‡´æ€§ã€‚ ç‹€æ³äºŒï¼šTC é²é²æ²’æœ‰æ”¶åˆ°å¸³æˆ¶ A çš„ç¢ºèªå›è¦† æœƒæ¼”è®Šæˆæ•´ç­†äº¤æ˜“åœæ»¯ï¼Œé²é²æ²’æœ‰åæ‡‰â€¦ å¥—ç”¨ 2PC çš„è§£æ±ºç¨‹åºï¼š ä½¿ç”¨è€…å‘ TC æå‡ºäº¤æ˜“éœ€æ±‚ TC å‘å¸³æˆ¶ A, B è©¢å•å¯å¦é€²è¡Œäº¤æ˜“ TC åœ¨ä¸€å®šæ™‚é–“æ™‚é–“å¾Œæ²’æœ‰æ”¶åˆ°å¸³æˆ¶ A çš„å›è¦† TC å‘å¸³æˆ¶ A, B å‚³é€æ”¾æ£„çš„å‘½ä»¤ ( abort ) TC å›å‚³è½‰å¸³å¤±æ•—çš„è¨Šæ¯çµ¦ä½¿ç”¨è€…ã€‚ ç¤ºæ„åœ–å¦‚ä¸‹ï¼š é€™æ¨£ä¸€ä¾†ï¼Œä¹Ÿå¯ä»¥ç¢ºä¿å¾Œå°çš„è³‡æ–™ä¸€è‡´æ€§ã€‚ ç‹€æ³ä¸‰ï¼šå¸³æˆ¶ A, B çš†å‘ TC å›å‚³ç¢ºèªè¨Šæ¯ï¼Œä½†é²é²æ²’æœ‰æ”¶åˆ° TC çš„æœ€çµ‚æ±ºå®š æˆ‘å€‘ä»¥å¸³æˆ¶ B çš„è§’åº¦ä¾†çœ‹é€™ç¨®ç‹€æ³ï¼š å¯ä»¥å–®æ–¹é¢åŸ·è¡Œ commit æŒ‡ä»¤ ï¼Ÿä¸è¡Œ âŒ Â å› ç‚ºå¸³æˆ¶ A å¯èƒ½å‚³çµ¦ TC çš„ç¢ºèªæŒ‡ä»¤æ˜¯ Noã€‚ Â æœƒæ¼”è®Šæˆå¸³æˆ¶ A æ²’æœ‰åŸ·è¡Œä½†æ˜¯å¸³æˆ¶ B æœ‰åŸ·è¡Œçš„ç‹€æ³â€¦ å¯ä»¥å–®æ–¹é¢åŸ·è¡Œ abort æŒ‡ä»¤ ï¼Ÿä¸è¡Œ âŒ Â å› ç‚ºå¸³æˆ¶ A å¯èƒ½å‚³çµ¦ TC çš„ç¢ºèªæŒ‡ä»¤æ˜¯ Yesã€‚ Â æœƒæ¼”è®Šæˆå¸³æˆ¶ A æœ‰åŸ·è¡Œä½†æ˜¯å¸³æˆ¶ B æ²’æœ‰åŸ·è¡Œçš„ç‹€æ³â€¦ é‚£å…©ç¨®è¡Œå‹•éƒ½ä¸èƒ½åšï¼Œè©²æ€éº¼è¾¦ï¼Ÿ ç¹¼çºŒç­‰â€¦ ( æœŸç›¼å¥‡è¹Ÿæœƒå‡ºç¾ ğŸ¦¥ â€¦) å¯¦æ–½ è¶…æ™‚çµ‚æ­¢å”è­° Â ç°¡å–®ä¾†èªªå°±æ˜¯å„å€‹ cohort ä¹‹é–“äº’ç›¸ç¢ºèªç‹€æ³ï¼Œå› ç‚ºæ¶‰åŠçš„ç‹€æ³è¤‡é›œï¼Œæœ¬æ–‡ä¸è¨è«– ä¸€èˆ¬ cohorts å›è¦† TC ä¹‹å¾Œå°±æœƒé–å®šå„è‡ªçš„è³‡æºä¸è¦è®“å…¶ä»–çš„é‚è¼¯å¹²æ“¾ï¼Œä½†æ˜¯ç¾åœ¨ TC å»æ²’æœ‰ä¸‹é”åŸ·è¡Œçš„å‘½ä»¤ï¼Œæ‰€ä»¥é€ æˆå¯æ€•çš„ç¾è±¡ï¼š æ•´å€‹äº¤æ˜“åœæ»¯ â€¦ é‡åˆ°é€™æ¨£çš„å•é¡Œï¼Œæˆ‘å€‘å¯ä»¥è©¦è©¦ ä¸‰éšæ®µæäº¤ ","date":"2022-02-28","objectID":"/two-pc-intro/:2:3","tags":["distribution","algorithm","commit","abort","rollback","consistency"],"title":"è·¨ä¼ºæœå™¨äº¤æ˜“è™•ç† â€” èªè­˜äºŒéšæ®µæäº¤ ( 2PC )","uri":"/two-pc-intro/"},{"categories":["Algorithm"],"content":"ä¸‰éšæ®µæäº¤ ( two-phase commit, 3PC ) ç°¡å–®ä¾†èªªï¼Œå°±æ˜¯å°‡äºŒéšæ®µæäº¤çš„ç¬¬ä¸€å€‹æ­¥é©Ÿ ( è©¢å• ) æ‹†æˆï¼šè©¢å• + é–å®šè³‡æºï¼Œæœ€å¾Œæ‰æ˜¯ä¸‹é”åŸ·è¡Œçš„å‘½ä»¤ï¼Œæ‰€ä»¥ç¸½å…±æœ‰ä¸‰å€‹éšæ®µçµ„æˆã€‚ ä¸‰éšæ®µæäº¤çš„æ ¸å¿ƒæ€æƒ³æ˜¯è©¢å•æ™‚ä¸é–å®šè³‡æºï¼Œé™¤éæ‰€æœ‰äººéƒ½åŒæ„æ‰é–å®šè³‡æºã€‚ æ•´å€‹æµç¨‹æœƒæ˜¯ï¼š ä½¿ç”¨è€…å‘ TC æå‡ºè½‰å¸³çš„éœ€æ±‚ TC è©¢å•å„å€‹ cohorts cohorts éƒ½è¿”å› Yes TC ä¸‹é” pre-commit cohorts é–å®šå„è‡ªè³‡æºä¸¦ä¸”éƒ½å›å‚³ Yes TC ä¸‹é”æœ€çµ‚ commit ï¼† å›è¦†ä½¿ç”¨è€… OK ç¤ºæ„åœ–ï¼š å†å›ä¾†çœ‹ç‹€æ³ä¸‰çš„æƒ…å½¢ï¼Œæˆ‘å€‘å¯ä»¥è¨­è¨ˆæˆç•¶å¸³æˆ¶ A,B ä¸€æ®µæ™‚å…§é–“æ²’æœ‰æ”¶åˆ°ä¾†è‡ª TC æœ€çµ‚çš„ commit è¨Šæ¯æ™‚å°±é‡‹æ”¾è³‡æºä¸¦ä¸”å–æ¶ˆæ“ä½œï¼Œé€™æ¨£ä¸€ä¾†ä¹Ÿå¯ä»¥ä¿æŒè³‡æ–™çš„ä¸€è‡´æ€§ã€‚ ","date":"2022-02-28","objectID":"/two-pc-intro/:2:4","tags":["distribution","algorithm","commit","abort","rollback","consistency"],"title":"è·¨ä¼ºæœå™¨äº¤æ˜“è™•ç† â€” èªè­˜äºŒéšæ®µæäº¤ ( 2PC )","uri":"/two-pc-intro/"},{"categories":["Algorithm"],"content":"å…©è»å•é¡Œ ( Two Generalâ€™s Problem ) å…©è»å•é¡Œæ˜¯ä¸€å€‹æ€ç¶­æ€§å¯¦é©—å•é¡Œï¼Œç‹€æ³å¦‚ä¸‹ï¼š æœ‰å…©æ”¯è»éšŠï¼Œåˆ†åˆ¥ç”±ä¸€ä½å°‡è»é ˜å°ï¼Œå…±åŒç›®çš„æ˜¯è¦æ“Šæ½°æŸå€‹æ•µæ–¹åŸæ± ã€‚ å…©è»æ´¾å‡ºçš„ä¿¡ä½¿å¿…é ˆè¦é€šéæ•µæ–¹é ˜åœ°ï¼Œä¸¦ä¸”ä¿¡ä½¿æœ‰å¯èƒ½è¢«æ•µæ–¹ä¿˜è™œã€‚ ä¸€å®šè¦å…©è»åŒæ™‚ç™¼èµ·é€²æ”»æ‰æœƒæˆåŠŸï¼Œåªæœ‰ä¸€æ”¯è»éšŠé€²æ”»æœƒå°è‡´å¤±æ•—ã€‚ ç™¼ç¾ä¸ç®¡è¨­è¨ˆæ€éº¼æ¨£çš„æ–¹æ³•éƒ½ç„¡æ³•ä¿è­‰å…©è»ä¸€å®šå¯ä»¥åœ¨åŒä¸€æ™‚é–“é€²æ”»ï¼Œæ‰€ä»¥é€™å€‹å•é¡ŒåŸºæœ¬ä¸Šæ˜¯ç„¡è§£çš„ã€‚ å…©è»å•é¡Œå°±æ˜¯å°ç¾ä»£æ¯å€‹ç¯€é»ä½¿ç”¨ç¶²éš›ç¶²è·¯å½¼æ­¤é€²è¡Œæºé€šçš„å½±å°„ã€‚ æˆ‘å€‘æ²’æœ‰å®Œç¾çš„è¾¦æ³•ï¼Œä½†æ˜¯å¯ä»¥æ€ç´¢å‡ºå¯æ¥å—çš„è¾¦æ³•ã€‚ ","date":"2022-02-28","objectID":"/two-pc-intro/:2:5","tags":["distribution","algorithm","commit","abort","rollback","consistency"],"title":"è·¨ä¼ºæœå™¨äº¤æ˜“è™•ç† â€” èªè­˜äºŒéšæ®µæäº¤ ( 2PC )","uri":"/two-pc-intro/"},{"categories":["Algorithm"],"content":"ç¸½çµ äºŒéšæ®µæäº¤æ˜¯ä¸€ç¨®ç”¨ä¾†é”æˆåˆ†æ•£å¼äº¤æ˜“çš„è¨­è¨ˆæ–¹å¼ã€‚ äºŒéšæ®µæäº¤åˆ†ç‚ºã€Œ è©¢å• ã€ä»¥åŠã€Œ æäº¤ ã€å…©å€‹éšæ®µã€‚ äºŒéšæ®µæäº¤éœ€è¦æœ‰å”èª¿è€… ( Transaction Coordinator ) ä»¥åŠåƒèˆ‡è€… ( Cohort )ã€‚ å”èª¿è€…åªæ˜¯ä¸€å€‹æŠ½è±¡çš„è§’è‰²ï¼Œå¯¦éš›ä¸Šå¯ä»¥æŠŠå®ƒæ”¾åœ¨æŸä¸€å€‹åƒèˆ‡è€…ä¹‹ä¸­ä¾†å¯¦ä½œä¹Ÿæ˜¯ OKã€‚ åˆ†æ•£å¼äº‹å‹™æœ€å¸¸é‡åˆ°çš„ç‹€æ³åˆ†é¡ç‚ºï¼šé‡å•Ÿ \u0026 éŸ¿æ‡‰è¶…æ™‚ ( timeout )ï¼Œå…¶ä¸­å¾Œè€…æœ€ç‚ºè¤‡é›œéº»ç…©ã€‚ ä¸‰éšæ®µæäº¤åˆ†ç‚ºã€Œ è©¢å• ã€,ã€Œ é–å®šè³‡æº ã€\u0026ã€Œ æäº¤ ã€ä¸‰å€‹éšæ®µã€‚ ä¸‰éšæ®µæäº¤å¯ä»¥ç”¨ä¾†å½Œè£œäºŒéšæ®µåƒèˆ‡è€…ç¢ºèªå›è¦†å³é–å®šè³‡æºé€ æˆç­‰å¾…çš„çª˜å¢ƒã€‚ å»ºç«‹åœ¨ä¸å¯é çš„æºé€šæ¸ é“çš„å…©è»å•é¡Œæ ¹æœ¬ä¸Šæ˜¯ç„¡è§£ï¼Œåªèƒ½è¨­è¨ˆè¼ƒèƒ½æ¥å—çš„è™•ç†æ–¹å¼ã€‚ ç¾å¯¦ä¸­å¯¦ä½œ 2PC æˆ–æ˜¯ 3PC éƒ½å°‡æœƒæ˜¯å¾ˆå¤§çš„æŒ‘æˆ°ã€‚ ","date":"2022-02-28","objectID":"/two-pc-intro/:3:0","tags":["distribution","algorithm","commit","abort","rollback","consistency"],"title":"è·¨ä¼ºæœå™¨äº¤æ˜“è™•ç† â€” èªè­˜äºŒéšæ®µæäº¤ ( 2PC )","uri":"/two-pc-intro/"},{"categories":["Algorithm"],"content":"åƒè€ƒ äºŒéšæ®µæäº¤ å…©è»å•é¡Œ æ­£ç¡®ç†è§£äºŒé˜¶æ®µæäº¤ï¼ˆTwo-Phase Commitï¼‰ åˆ†å¸ƒå¼ç³»ç»Ÿçš„äº‹åŠ¡å¤„ç† ","date":"2022-02-28","objectID":"/two-pc-intro/:4:0","tags":["distribution","algorithm","commit","abort","rollback","consistency"],"title":"è·¨ä¼ºæœå™¨äº¤æ˜“è™•ç† â€” èªè­˜äºŒéšæ®µæäº¤ ( 2PC )","uri":"/two-pc-intro/"}]