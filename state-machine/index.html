<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=robots content="noodp">
<meta http-equiv=x-ua-compatible content="IE=edge, chrome=1">
<title>進入設計模式的世界 -- 狀態機模式 ( State pattern ) - Darren's Blog</title><meta name=Description content="讓我嘗試用 Java 來實作狀態模式吧！"><meta property="og:title" content="進入設計模式的世界 -- 狀態機模式 ( State pattern )">
<meta property="og:description" content="讓我嘗試用 Java 來實作狀態模式吧！">
<meta property="og:type" content="article">
<meta property="og:url" content="https://carrican.github.io/state-machine/"><meta property="og:image" content="https://carrican.github.io/state-machine/images/unplash-signature.jpeg"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2022-08-11T11:44:04+08:00">
<meta property="article:modified_time" content="2022-08-11T11:44:04+08:00"><meta property="og:site_name" content="Darren's Blog">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://carrican.github.io/state-machine/images/unplash-signature.jpeg">
<meta name=twitter:title content="進入設計模式的世界 -- 狀態機模式 ( State pattern )">
<meta name=twitter:description content="讓我嘗試用 Java 來實作狀態模式吧！">
<meta name=application-name content="Darren's Blog">
<meta name=apple-mobile-web-app-title content="Darren's Blog"><meta name=theme-color content="#ffffff"><meta name=msapplication-TileColor content="#da532c"><link rel="shortcut icon" type=image/x-icon href=/favicon.ico>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link rel=manifest href=/site.webmanifest><link rel=canonical href=https://carrican.github.io/state-machine/><link rel=prev href=https://carrican.github.io/two-pc-intro/><link rel=next href=https://carrican.github.io/aspectj/><link rel=stylesheet href=/lib/normalize/normalize.min.css><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/lib/fontawesome-free/all.min.css><link rel=stylesheet href=/lib/animate/animate.min.css><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"進入設計模式的世界 -- 狀態機模式 ( State pattern )","inLanguage":"en","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/carrican.github.io\/state-machine\/"},"image":[{"@type":"ImageObject","url":"https:\/\/carrican.github.io\/state-machine\/images\/unplash-signature.jpeg","width":2500,"height":2e3}],"genre":"posts","keywords":"Java, design, pattern, state, machine, transition","wordcount":1129,"url":"https:\/\/carrican.github.io\/state-machine\/","datePublished":"2022-08-11T11:44:04+08:00","dateModified":"2022-08-11T11:44:04+08:00","publisher":{"@type":"Organization","name":""},"author":{"@type":"Person","name":"Darren"},"description":"讓我嘗試用 Java 來實作狀態模式吧！"}</script></head>
<body header-desktop=fixed header-mobile=auto><script type=text/javascript>(window.localStorage&&localStorage.getItem('theme')?localStorage.getItem('theme')==='dark':'light'==='auto'?window.matchMedia('(prefers-color-scheme: dark)').matches:'light'==='dark')&&document.body.setAttribute('theme','dark')</script>
<div id=mask></div><div class=wrapper><header class=desktop id=header-desktop>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title="Darren's Blog"><span class=header-title-pre><i class="fas fa-cog fa-spin"></i></span> Darren's Blog</a>
</div>
<div class=menu>
<div class=menu-inner><a class=menu-item href=/posts/> Posts </a><a class=menu-item href=/tags/> Tags </a><a class=menu-item href=/categories/> Categories </a><span class="menu-item delimiter"></span><span class="menu-item search" id=search-desktop>
<input type=text placeholder="Search titles or contents..." id=search-input-desktop>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-desktop title=Search>
<i class="fas fa-search fa-fw"></i>
</a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-desktop title=Clear>
<i class="fas fa-times-circle fa-fw"></i>
</a>
<span class="search-button search-loading" id=search-loading-desktop>
<i class="fas fa-spinner fa-fw fa-spin"></i>
</span>
</span><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i>
</a>
</div>
</div>
</div>
</header><header class=mobile id=header-mobile>
<div class=header-container>
<div class=header-wrapper>
<div class=header-title>
<a href=/ title="Darren's Blog"><span class=header-title-pre><i class="fas fa-cog fa-spin"></i></span> Darren's Blog</a>
</div>
<div class=menu-toggle id=menu-toggle-mobile>
<span></span><span></span><span></span>
</div>
</div>
<div class=menu id=menu-mobile><div class=search-wrapper>
<div class="search mobile" id=search-mobile>
<input type=text placeholder="Search titles or contents..." id=search-input-mobile>
<a href=javascript:void(0); class="search-button search-toggle" id=search-toggle-mobile title=Search>
<i class="fas fa-search fa-fw"></i>
</a>
<a href=javascript:void(0); class="search-button search-clear" id=search-clear-mobile title=Clear>
<i class="fas fa-times-circle fa-fw"></i>
</a>
<span class="search-button search-loading" id=search-loading-mobile>
<i class="fas fa-spinner fa-fw fa-spin"></i>
</span>
</div>
<a href=javascript:void(0); class=search-cancel id=search-cancel-mobile>
Cancel
</a>
</div><a class=menu-item href=/posts/ title>Posts</a><a class=menu-item href=/tags/ title>Tags</a><a class=menu-item href=/categories/ title>Categories</a><a href=javascript:void(0); class="menu-item theme-switch" title="Switch Theme">
<i class="fas fa-adjust fa-fw"></i>
</a></div>
</div>
</header>
<div class="search-dropdown desktop">
<div id=search-dropdown-desktop></div>
</div>
<div class="search-dropdown mobile">
<div id=search-dropdown-mobile></div>
</div>
<main class=main>
<div class=container><div class=toc id=toc-auto>
<h2 class=toc-title>Contents</h2>
<div class="toc-content always-active" id=toc-content-auto></div>
</div><article class="page single"><h1 class="single-title animated flipInX">進入設計模式的世界 -- 狀態機模式 ( State pattern )</h1><div class=post-meta>
<div class=post-meta-line><span class=post-author><a href=/ title=Author rel=author class=author><i class="fas fa-user-circle fa-fw"></i>Darren</a></span>&nbsp;<span class=post-category>included in <a href=/categories/design-pattern/><i class="far fa-folder fa-fw"></i>Design Pattern</a></span></div>
<div class=post-meta-line><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime=2022-08-11>2022-08-11</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1129 words&nbsp;
<i class="far fa-clock fa-fw"></i>&nbsp;6 minutes&nbsp;</div>
</div><div class="details toc" id=toc-static kept>
<div class="details-summary toc-title">
<span>Contents</span>
<span><i class="details-icon fas fa-angle-right"></i></span>
</div>
<div class="details-content toc-content" id=toc-content-static><nav id=TableOfContents>
<ul>
<li><a href=#前言-a-idprefacea>前言 <a id=preface></a></a></li>
<li><a href=#本文-a-idmain-contenta>本文 <a id=main-content></a></a>
<ul>
<li><a href=#場景一簡單的傳簽系統a-idscenario-1a>場景一：簡單的傳簽系統<a id=scenario-1></a></a></li>
<li><a href=#場景二漸漸複雜的傳簽系統a-idscenario-2a>場景二：漸漸複雜的傳簽系統<a id=scenario-2></a></a></li>
<li><a href=#更多複雜的場景-a-idscenario-futurea>更多複雜的場景 <a id=scenario-future></a></a></li>
</ul>
</li>
<li><a href=#總結>總結</a></li>
<li><a href=#參考>參考</a></li>
</ul>
</nav></div>
</div><div class=content id=content><h2 id=前言-a-idprefacea>前言 <a id=preface></a></h2>
<p>「狀態機模式」( State Pattern ) 是眾多設計模式中的一種，主要是用來處理一種物件可能依照不同的狀態而有不同行為的情況。</p>
<p>可以應用的場景有錄音機、紅綠燈等。若是商業方面的應用話，如包裹運送、文件傳簽等。</p>
<p>本文就以公司裡面會出現的「傳簽」來當作狀態模式的應用場景。</p>
<br>
<figure><img src=images/unplash-signature.jpeg alt="Photo by Signature Pro in Unsplash"><figcaption>
<p><em>Photo by Signature Pro in Unsplash</em></p>
</figcaption>
</figure>
<br>
<h2 id=本文-a-idmain-contenta>本文 <a id=main-content></a></h2>
<h3 id=場景一簡單的傳簽系統a-idscenario-1a>場景一：簡單的傳簽系統<a id=scenario-1></a></h3>
<p>假設現在有一間新創公司剛成立一年，內部設計出如下圖的傳簽流程：</p>
<div class=mermaid id=id-1></div>
<p>我準備了以下幾項東西來符合需求：</p>
<ul>
<li>
<p>狀態機 ( State Machine )</p>
</li>
<li>
<p>狀態 ( State )</p>
</li>
<li>
<p>狀態資訊 ( StateInfo )</p>
</li>
</ul>
<br>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>StateMachine</span> <span class=o>{</span>
    <span class=cm>/* Switch to next state */</span>
    <span class=kt>void</span> <span class=nf>nextState</span><span class=o>();</span>

    <span class=cm>/* Print current information */</span>
    <span class=kt>void</span> <span class=nf>info</span><span class=o>();</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>State</span> <span class=o>{</span>
    <span class=cm>/* Set next state */</span>
    <span class=kt>void</span> <span class=nf>setNextState</span><span class=o>(</span><span class=n>State</span> <span class=n>nextState</span><span class=o>);</span>

    <span class=cm>/* Switch to &amp; return next state */</span>
    <span class=n>State</span> <span class=nf>nextState</span><span class=o>();</span>

    <span class=cm>/* Print current state information */</span>
    <span class=kt>void</span> <span class=nf>printStateInfo</span><span class=o>();</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p><div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SignatureStateMachine</span> <span class=kd>implements</span> <span class=n>StateMachine</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=n>State</span> <span class=n>currentState</span><span class=o>;</span>

    <span class=kd>public</span> <span class=nf>SignatureStateMachine</span><span class=o>(</span><span class=n>State</span> <span class=n>currentState</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>this</span><span class=o>.</span><span class=na>currentState</span> <span class=o>=</span> <span class=n>currentState</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>nextState</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>currentState</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=n>currentState</span> <span class=o>=</span> <span class=n>currentState</span><span class=o>.</span><span class=na>nextState</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>info</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>currentState</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>currentState</span><span class=o>.</span><span class=na>printStateInfo</span><span class=o>();</span>
        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Already approved!&#34;</span><span class=o>);</span>
        <span class=o>}</span>
    <span class=o>}</span>
<span class=o>}</span></code></pre></td></tr></table>
</div>
</div>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SignatureState</span> <span class=kd>implements</span> <span class=n>State</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=n>State</span> <span class=n>nextState</span><span class=o>;</span>

    <span class=kd>private</span> <span class=n>StateInfo</span> <span class=n>info</span><span class=o>;</span>

    <span class=kd>public</span> <span class=nf>SignatureState</span><span class=o>(</span><span class=n>StateInfo</span> <span class=n>info</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>this</span><span class=o>.</span><span class=na>info</span> <span class=o>=</span> <span class=n>info</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setNextState</span><span class=o>(</span><span class=n>State</span> <span class=n>nextState</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>this</span><span class=o>.</span><span class=na>nextState</span> <span class=o>=</span> <span class=n>nextState</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>State</span> <span class=nf>nextState</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>nextState</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>printStateInfo</span><span class=o>()</span> <span class=o>{</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Now, the state is &#34;</span> <span class=o>+</span> <span class=n>info</span><span class=o>.</span><span class=na>getInfo</span><span class=o>());</span>
    <span class=o>}</span>
<span class=o>}</span></code></pre></td></tr></table>
</div>
</div></p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>enum</span> <span class=n>StateInfo</span> <span class=o>{</span>
    <span class=n>DRAFT</span><span class=o>(</span><span class=s>&#34;Draft&#34;</span><span class=o>),</span>
    <span class=n>WATING_FOR_BOSS</span><span class=o>(</span><span class=s>&#34;Waiting for boss&#34;</span><span class=o>),</span>
    <span class=n>APPROVED</span><span class=o>(</span><span class=s>&#34;Approved&#34;</span><span class=o>);</span>

    <span class=kd>private</span> <span class=n>String</span> <span class=n>info</span><span class=o>;</span>
    <span class=n>StateInfo</span><span class=o>(</span><span class=n>String</span> <span class=n>info</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>this</span><span class=o>.</span><span class=na>info</span> <span class=o>=</span> <span class=n>info</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getInfo</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>return</span> <span class=n>info</span><span class=o>;</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><br>
<p>接著，我們來操作這次的狀態轉移。</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SignatureDemo</span> <span class=o>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>State</span> <span class=n>draftState</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SignatureState</span><span class=o>(</span><span class=n>StateInfo</span><span class=o>.</span><span class=na>DRAFT</span><span class=o>);</span>
        <span class=n>State</span> <span class=n>waitingForBossState</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SignatureState</span><span class=o>(</span><span class=n>StateInfo</span><span class=o>.</span><span class=na>WATING_FOR_BOSS</span><span class=o>);</span>
        <span class=n>State</span> <span class=n>approvedState</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SignatureState</span><span class=o>(</span><span class=n>StateInfo</span><span class=o>.</span><span class=na>APPROVED</span><span class=o>);</span>

        <span class=n>draftState</span><span class=o>.</span><span class=na>setNextState</span><span class=o>(</span><span class=n>waitingForBossState</span><span class=o>);</span>
        <span class=n>waitingForBossState</span><span class=o>.</span><span class=na>setNextState</span><span class=o>(</span><span class=n>approvedState</span><span class=o>);</span>
        <span class=n>approvedState</span><span class=o>.</span><span class=na>setNextState</span><span class=o>(</span><span class=kc>null</span><span class=o>);</span>

        <span class=n>StateMachine</span> <span class=n>signSystem</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SignatureStateMachine</span><span class=o>(</span><span class=n>draftState</span><span class=o>);</span>
        <span class=n>signSystem</span><span class=o>.</span><span class=na>info</span><span class=o>();</span> <span class=c1>// &#34;Now, the state is Draft&#34;
</span><span class=c1></span>
        <span class=n>signSystem</span><span class=o>.</span><span class=na>nextState</span><span class=o>();</span>
        <span class=n>signSystem</span><span class=o>.</span><span class=na>info</span><span class=o>();</span> <span class=c1>// &#34;Now, the state is Waiting for boss&#34;
</span><span class=c1></span>
        <span class=n>signSystem</span><span class=o>.</span><span class=na>nextState</span><span class=o>();</span>
        <span class=n>signSystem</span><span class=o>.</span><span class=na>info</span><span class=o>();</span> <span class=c1>// &#34;Now, the state is Approved&#34;
</span><span class=c1></span>
        <span class=n>signSystem</span><span class=o>.</span><span class=na>nextState</span><span class=o>();</span>
        <span class=n>signSystem</span><span class=o>.</span><span class=na>info</span><span class=o>();</span> <span class=c1>// &#34;Already approved!&#34;
</span><span class=c1></span>
        <span class=n>signSystem</span><span class=o>.</span><span class=na>nextState</span><span class=o>();</span>
        <span class=n>signSystem</span><span class=o>.</span><span class=na>info</span><span class=o>();</span> <span class=c1>// &#34;Already approved!&#34;
</span><span class=c1></span>    <span class=o>}</span>
<span class=o>}</span>

</code></pre></td></tr></table>
</div>
</div><br>
<h3 id=場景二漸漸複雜的傳簽系統a-idscenario-2a>場景二：漸漸複雜的傳簽系統<a id=scenario-2></a></h3>
<p>上個例子比較簡單，現在開始加入一些現實上可能會遇到的問題，並且調整我們的程式碼來符合需求。加入考慮的項目如下：</p>
<ol>
<li>
<p>公司雇用一位部門主管，文件簽核必須依序簽合。</p>
</li>
<li>
<p>部門主管與老闆可以退回文件，文件傳回上一狀態。</p>
</li>
</ol>
<br>
<p>新的傳簽流程：</p>
<div class=mermaid id=id-2></div>
<br>
<p>這次的情境不再是只有單一的狀態轉移，因此我們新建立簽署動作 ( Sign action ) 來當作狀態轉移的判斷標準。</p>
<p>簽署動作 ( Sign action ):</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>enum</span> <span class=n>SignAction</span> <span class=o>{</span>
    <span class=n>SIGN</span><span class=o>(</span><span class=n>1</span><span class=o>),</span>
    <span class=n>REJECT</span><span class=o>(</span><span class=n>2</span><span class=o>);</span>

    <span class=kd>private</span> <span class=n>Integer</span> <span class=n>code</span><span class=o>;</span>

    <span class=n>SignAction</span><span class=o>(</span><span class=n>Integer</span> <span class=n>code</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>this</span><span class=o>.</span><span class=na>code</span> <span class=o>=</span> <span class=n>code</span><span class=o>;</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>我們沿用上面的狀態機 ( StateMachine ) 介面，但是改寫狀態 ( State ) 介面，並且重新實作它們。</p>
<p>重新定義的狀態介面如下：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>interface</span> <span class=nc>State</span> <span class=o>{</span>
    <span class=cm>/* Register a next state */</span>
    <span class=kt>void</span> <span class=nf>registerNextState</span><span class=o>(</span><span class=n>SignAction</span> <span class=n>action</span><span class=o>,</span> <span class=n>State</span> <span class=n>nextState</span><span class=o>);</span>

    <span class=cm>/* Switch to &amp; return next state */</span>
    <span class=n>State</span> <span class=nf>nextState</span><span class=o>(</span><span class=n>SignAction</span> <span class=n>action</span><span class=o>);</span>

    <span class=cm>/* Print current state information */</span>
    <span class=kt>void</span> <span class=nf>printStateInfo</span><span class=o>();</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><br>
<p>狀態機 ( State Machine )</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SignatureStateMachine</span> <span class=kd>implements</span> <span class=n>StateMachine</span> <span class=o>{</span>

    <span class=kd>private</span> <span class=n>State</span> <span class=n>currentState</span><span class=o>;</span>

    <span class=kd>public</span> <span class=nf>SignatureStateMachine</span><span class=o>(</span><span class=n>State</span> <span class=n>currentState</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>this</span><span class=o>.</span><span class=na>currentState</span> <span class=o>=</span> <span class=n>currentState</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>nextState</span><span class=o>(</span><span class=n>SignAction</span> <span class=n>action</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>currentState</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=n>currentState</span> <span class=o>=</span> <span class=n>currentState</span><span class=o>.</span><span class=na>nextState</span><span class=o>(</span><span class=n>action</span><span class=o>);</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>info</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>currentState</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>currentState</span><span class=o>.</span><span class=na>printStateInfo</span><span class=o>();</span>
        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
            <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Already approved!&#34;</span><span class=o>);</span>
        <span class=o>}</span>
    <span class=o>}</span>

    <span class=cm>/* The static method to generate a custom signature system */</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=n>SignatureStateMachine</span> <span class=nf>generateSignatureSystem</span><span class=o>()</span> <span class=o>{</span>
        <span class=n>State</span> <span class=n>draftState</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SignatureState</span><span class=o>(</span><span class=n>StateInfo</span><span class=o>.</span><span class=na>DRAFT</span><span class=o>);</span>
        <span class=n>State</span> <span class=n>waitingForLeaderState</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SignatureState</span><span class=o>(</span><span class=n>StateInfo</span><span class=o>.</span><span class=na>WATING_FOR_LEADER</span><span class=o>);</span>
        <span class=n>State</span> <span class=n>waitingForBossState</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SignatureState</span><span class=o>(</span><span class=n>StateInfo</span><span class=o>.</span><span class=na>WATING_FOR_BOSS</span><span class=o>);</span>
        <span class=n>State</span> <span class=n>approvedState</span> <span class=o>=</span> <span class=k>new</span> <span class=n>SignatureState</span><span class=o>(</span><span class=n>StateInfo</span><span class=o>.</span><span class=na>APPROVED</span><span class=o>);</span>

        <span class=n>draftState</span><span class=o>.</span><span class=na>registerNextState</span><span class=o>(</span><span class=n>SignAction</span><span class=o>.</span><span class=na>SIGN</span><span class=o>,</span> <span class=n>waitingForLeaderState</span><span class=o>);</span>
        <span class=n>waitingForLeaderState</span><span class=o>.</span><span class=na>registerNextState</span><span class=o>(</span><span class=n>SignAction</span><span class=o>.</span><span class=na>SIGN</span><span class=o>,</span> <span class=n>waitingForBossState</span><span class=o>);</span>
        <span class=n>waitingForLeaderState</span><span class=o>.</span><span class=na>registerNextState</span><span class=o>(</span><span class=n>SignAction</span><span class=o>.</span><span class=na>REJECT</span><span class=o>,</span> <span class=n>draftState</span><span class=o>);</span>
        <span class=n>waitingForBossState</span><span class=o>.</span><span class=na>registerNextState</span><span class=o>(</span><span class=n>SignAction</span><span class=o>.</span><span class=na>SIGN</span><span class=o>,</span> <span class=n>approvedState</span><span class=o>);</span>
        <span class=n>waitingForBossState</span><span class=o>.</span><span class=na>registerNextState</span><span class=o>(</span><span class=n>SignAction</span><span class=o>.</span><span class=na>REJECT</span><span class=o>,</span> <span class=n>waitingForLeaderState</span><span class=o>);</span>

        <span class=k>return</span> <span class=k>new</span> <span class=n>SignatureStateMachine</span><span class=o>(</span><span class=n>draftState</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><p>狀態 ( State )</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SignatureState</span> <span class=kd>implements</span> <span class=n>State</span><span class=o>{</span>

    <span class=kd>private</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>SignAction</span><span class=o>,</span> <span class=n>State</span><span class=o>&gt;</span> <span class=n>map</span> <span class=o>=</span> <span class=k>new</span> <span class=n>EnumMap</span><span class=o>&lt;&gt;(</span><span class=n>SignAction</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>

    <span class=kd>private</span> <span class=n>StateInfo</span> <span class=n>info</span><span class=o>;</span>

    <span class=kd>public</span> <span class=nf>SignatureState</span><span class=o>(</span><span class=n>StateInfo</span> <span class=n>info</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>this</span><span class=o>.</span><span class=na>info</span> <span class=o>=</span> <span class=n>info</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>registerNextState</span><span class=o>(</span><span class=n>SignAction</span> <span class=n>action</span><span class=o>,</span> <span class=n>State</span> <span class=n>nextState</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>map</span><span class=o>.</span><span class=na>put</span><span class=o>(</span><span class=n>action</span><span class=o>,</span> <span class=n>nextState</span><span class=o>);</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=n>State</span> <span class=nf>nextState</span><span class=o>(</span><span class=n>SignAction</span> <span class=n>action</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(</span><span class=n>map</span><span class=o>.</span><span class=na>containsKey</span><span class=o>(</span><span class=n>action</span><span class=o>))</span> <span class=o>{</span>
            <span class=k>return</span> <span class=n>map</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>action</span><span class=o>);</span>
        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>StateError</span><span class=o>.</span><span class=na>NoSuchStateException</span><span class=o>();</span>
        <span class=o>}</span>
    <span class=o>}</span>

    <span class=nd>@Override</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>printStateInfo</span><span class=o>()</span> <span class=o>{</span>
        <span class=n>System</span><span class=o>.</span><span class=na>out</span><span class=o>.</span><span class=na>println</span><span class=o>(</span><span class=s>&#34;Now, the state is &#34;</span> <span class=o>+</span> <span class=n>info</span><span class=o>.</span><span class=na>getInfo</span><span class=o>()</span> <span class=o>+</span> <span class=s>&#34;.&#34;</span><span class=o>);</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><br>
<p>此外，我們把狀態機直接封裝在文件 ( File ) 內部，讓操作的人可以只需針對文件進行操作，不用知道內部的狀態實際上是怎麼運作。</p>
<br>
<p>文件 ( File )</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>File</span> <span class=o>{</span>
    <span class=cm>/* The file&#39;s content */</span>
    <span class=kd>private</span> <span class=n>String</span> <span class=n>content</span><span class=o>;</span>

    <span class=cm>/* Whether the file is submitted. */</span>
    <span class=kd>private</span> <span class=kt>boolean</span> <span class=n>submitted</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>

    <span class=cm>/* The map to store role &amp; password pairs. */</span>
    <span class=kd>private</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=n>roleToTokenMap</span> <span class=o>=</span> <span class=n>Map</span><span class=o>.</span><span class=na>ofEntries</span><span class=o>(</span>
            <span class=n>Map</span><span class=o>.</span><span class=na>entry</span><span class=o>(</span><span class=s>&#34;Leader&#34;</span><span class=o>,</span> <span class=s>&#34;leader-pass-123&#34;</span><span class=o>),</span>
            <span class=n>Map</span><span class=o>.</span><span class=na>entry</span><span class=o>(</span><span class=s>&#34;Boss&#34;</span><span class=o>,</span> <span class=s>&#34;boss-pass-456&#34;</span><span class=o>)</span>
    <span class=o>);</span>

    <span class=cm>/* Inner state machine */</span>
    <span class=kd>private</span> <span class=n>SignatureStateMachine</span> <span class=n>stateMachine</span> <span class=o>=</span> <span class=n>SignatureStateMachine</span><span class=o>.</span><span class=na>generateSignatureSystem</span><span class=o>();</span>

    <span class=kd>public</span> <span class=nf>File</span><span class=o>(</span><span class=n>String</span> <span class=n>content</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>this</span><span class=o>.</span><span class=na>content</span> <span class=o>=</span> <span class=n>content</span><span class=o>;</span>
    <span class=o>}</span>

    <span class=cm>/* Display the file&#39;s state information */</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>stateInfo</span><span class=o>()</span> <span class=o>{</span>
        <span class=n>stateMachine</span><span class=o>.</span><span class=na>info</span><span class=o>();</span>
    <span class=o>}</span>

    <span class=cm>/* To sign the file */</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>sign</span><span class=o>(</span><span class=n>String</span> <span class=n>role</span><span class=o>,</span> <span class=n>String</span> <span class=n>password</span><span class=o>,</span> <span class=n>SignAction</span> <span class=n>action</span><span class=o>)</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(!</span><span class=n>submitted</span><span class=o>)</span> <span class=k>throw</span> <span class=k>new</span> <span class=n>StateError</span><span class=o>.</span><span class=na>NotSubmittedException</span><span class=o>();</span>

        <span class=k>if</span> <span class=o>(</span><span class=n>roleToTokenMap</span><span class=o>.</span><span class=na>containsKey</span><span class=o>(</span><span class=n>role</span><span class=o>)</span>
                <span class=o>&amp;&amp;</span> <span class=n>roleToTokenMap</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>role</span><span class=o>).</span><span class=na>equals</span><span class=o>(</span><span class=n>password</span><span class=o>))</span> <span class=o>{</span>
            <span class=n>stateMachine</span><span class=o>.</span><span class=na>nextState</span><span class=o>(</span><span class=n>action</span><span class=o>);</span>

            <span class=k>if</span> <span class=o>(</span><span class=n>role</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=s>&#34;Leader&#34;</span><span class=o>)</span> <span class=o>&amp;&amp;</span> <span class=n>SignAction</span><span class=o>.</span><span class=na>REJECT</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>action</span><span class=o>))</span> <span class=o>{</span>
                <span class=n>submitted</span> <span class=o>=</span> <span class=kc>false</span><span class=o>;</span>
            <span class=o>}</span>
        <span class=o>}</span>
    <span class=o>}</span>

    <span class=cm>/* To submit the file */</span>
    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>submit</span><span class=o>()</span> <span class=o>{</span>
        <span class=k>if</span> <span class=o>(!</span><span class=n>submitted</span><span class=o>)</span> <span class=o>{</span>
            <span class=n>stateMachine</span><span class=o>.</span><span class=na>nextState</span><span class=o>(</span><span class=n>SignAction</span><span class=o>.</span><span class=na>SIGN</span><span class=o>);</span>
            <span class=n>submitted</span> <span class=o>=</span> <span class=kc>true</span><span class=o>;</span>
        <span class=o>}</span> <span class=k>else</span> <span class=o>{</span>
            <span class=k>throw</span> <span class=k>new</span> <span class=n>StateError</span><span class=o>.</span><span class=na>AlreadySubmittedException</span><span class=o>();</span>
        <span class=o>}</span>
    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><br>
<p>狀態轉移如下：</p>
<div class=highlight><div class=chroma>
<table class=lntable><tr><td class=lntd>
<pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td>
<td class=lntd>
<pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=kd>public</span> <span class=kd>class</span> <span class=nc>SignatureDemo2</span> <span class=o>{</span>
    <span class=kd>public</span> <span class=kd>static</span> <span class=kt>void</span> <span class=nf>main</span><span class=o>(</span><span class=n>String</span><span class=o>[]</span> <span class=n>args</span><span class=o>)</span> <span class=o>{</span>
        <span class=n>String</span> <span class=n>fileContent</span> <span class=o>=</span> <span class=s>&#34;Promotion request.&#34;</span><span class=o>;</span>
        <span class=n>File</span> <span class=n>newFile</span> <span class=o>=</span> <span class=k>new</span> <span class=n>File</span><span class=o>(</span><span class=n>fileContent</span><span class=o>);</span>
        <span class=n>newFile</span><span class=o>.</span><span class=na>stateInfo</span><span class=o>();</span> <span class=c1>// &#34;Now, the state is Draft.&#34;
</span><span class=c1></span>
        <span class=n>newFile</span><span class=o>.</span><span class=na>submit</span><span class=o>();</span>
        <span class=n>newFile</span><span class=o>.</span><span class=na>stateInfo</span><span class=o>();</span> <span class=c1>// &#34;Now, the state is Waiting for leader.&#34;
</span><span class=c1></span>
        <span class=n>newFile</span><span class=o>.</span><span class=na>sign</span><span class=o>(</span><span class=s>&#34;Leader&#34;</span><span class=o>,</span> <span class=s>&#34;leader-pass-123&#34;</span><span class=o>,</span> <span class=n>SignAction</span><span class=o>.</span><span class=na>SIGN</span><span class=o>);</span>
        <span class=n>newFile</span><span class=o>.</span><span class=na>stateInfo</span><span class=o>();</span> <span class=c1>// &#34;Now, the state is Waiting for boss.&#34;
</span><span class=c1></span>
        <span class=n>newFile</span><span class=o>.</span><span class=na>sign</span><span class=o>(</span><span class=s>&#34;Boss&#34;</span><span class=o>,</span> <span class=s>&#34;boss-pass-456&#34;</span><span class=o>,</span> <span class=n>SignAction</span><span class=o>.</span><span class=na>REJECT</span><span class=o>);</span>
        <span class=n>newFile</span><span class=o>.</span><span class=na>stateInfo</span><span class=o>();</span> <span class=c1>// &#34;Now, the state is Waiting for leader.&#34;
</span><span class=c1></span>
        <span class=n>newFile</span><span class=o>.</span><span class=na>sign</span><span class=o>(</span><span class=s>&#34;Leader&#34;</span><span class=o>,</span> <span class=s>&#34;leader-pass-123&#34;</span><span class=o>,</span> <span class=n>SignAction</span><span class=o>.</span><span class=na>SIGN</span><span class=o>);</span>
        <span class=n>newFile</span><span class=o>.</span><span class=na>stateInfo</span><span class=o>();</span> <span class=c1>// &#34;Now, the state is Waiting for boss.&#34;
</span><span class=c1></span>
        <span class=n>newFile</span><span class=o>.</span><span class=na>sign</span><span class=o>(</span><span class=s>&#34;Boss&#34;</span><span class=o>,</span> <span class=s>&#34;boss-pass-456&#34;</span><span class=o>,</span> <span class=n>SignAction</span><span class=o>.</span><span class=na>SIGN</span><span class=o>);</span>
        <span class=n>newFile</span><span class=o>.</span><span class=na>stateInfo</span><span class=o>();</span> <span class=c1>// Now, the state is Approved.
</span><span class=c1></span>    <span class=o>}</span>
<span class=o>}</span>
</code></pre></td></tr></table>
</div>
</div><br>
<h3 id=更多複雜的場景-a-idscenario-futurea>更多複雜的場景 <a id=scenario-future></a></h3>
<p>真正在處理公司內部的業務邏輯的時候，複雜度往往沒有像上面兩個例子一樣簡單，好比下面傳簽的場景：</p>
<div class=mermaid id=id-3></div>
<p>在處理複雜場景的時候，還可以考慮以下幾點，讓狀態模式更動態 ( 當然也就更複雜&mldr; 😅 )</p>
<ul>
<li>
<p>抽象化轉換過程 ( Transition )。</p>
</li>
<li>
<p>封裝狀態機 ( State Machine ) 到會改變狀態的物件當中。</p>
</li>
<li>
<p>使用列舉 ( Enumerate ) 方式來定義狀態資訊 ( State Information )、轉換過程 ( Transition ) 等。</p>
</li>
<li>
<p>除了可以轉換的狀態之外，也紀錄上一個狀態。</p>
</li>
<li>
<p>有機會轉換失敗的話，加入回滾 ( Rollback )的轉換。</p>
</li>
</ul>
<br>
<p>當然&mldr;這篇文章就不寫出如何處理這樣的場景啦! 😉</p>
<br>
<h2 id=總結>總結</h2>
<ul>
<li>
<p>狀態模式 ( State Machine ) 主要是用來處理一種物件可能依照不同的狀態而有不同行為的情況。</p>
</li>
<li>
<p>狀態模式可以有不同的實作方式，但是核心精神在於處理狀態與轉移之間的關係。</p>
</li>
<li>
<p>設計過程中，可能涉及<a href=https://zh.wikipedia.org/zh-tw/%E6%9C%89%E9%99%90%E7%8A%B6%E6%80%81%E6%9C%BA target=_blank rel="noopener noreffer">有限狀態機 ( Finite-State Machine )</a> 模型。</p>
</li>
<li>
<p>常見的生活例子有紅綠燈、各式電器等等。商業應用的話好比傳簽系統、包裹配送系統、電子下單系統等等。</p>
</li>
<li>
<p>若面對比較複雜的場景，Java 的使用者可以選擇套用 <a href=https://spring.io/projects/spring-statemachine target=_blank rel="noopener noreffer">Spring Statemachine</a> 。</p>
</li>
</ul>
<br>
<h2 id=參考>參考</h2>
<ul>
<li>
<p><a href=https://www.baeldung.com/cs/state-machines target=_blank rel="noopener noreffer">State Machines: Components, Representations, Applications</a></p>
</li>
<li>
<p><a href=https://www.baeldung.com/java-state-design-pattern target=_blank rel="noopener noreffer">State Design Pattern in Java</a></p>
</li>
<li>
<p><a href=https://www.baeldung.com/java-finite-automata target=_blank rel="noopener noreffer">Validating Input with Finite Automata in Java</a></p>
</li>
<li>
<p><a href=https://www.baeldung.com/spring-state-machine target=_blank rel="noopener noreffer">A Guide to the Spring State Machine Project</a></p>
</li>
<li>
<p><a href=https://www.baeldung.com/java-enum-simple-state-machine target=_blank rel="noopener noreffer">Implementing Simple State Machines with Java Enums</a></p>
</li>
<li>
<p><a href=https://balaaagi.medium.com/simple-state-machines-in-java-ed2a3db35a34 target=_blank rel="noopener noreffer">Simple State Machines in Java</a></p>
</li>
</ul></div><div class=post-footer id=post-footer>
<div class=post-info>
<div class=post-info-line>
<div class=post-info-mod>
<span>Updated on 2022-08-11</span>
</div>
<div class=post-info-license></div>
</div>
<div class=post-info-line>
<div class=post-info-md><span>
<a class=link-to-markdown href=/state-machine/index.md target=_blank>Read Markdown</a>
</span></div>
<div class=post-info-share>
<span><a href=javascript:void(0); title="Share on Twitter" data-sharer=twitter data-url=https://carrican.github.io/state-machine/ data-title="進入設計模式的世界 -- 狀態機模式 ( State pattern )" data-hashtags=Java,design,pattern,state,machine,transition><i class="fab fa-twitter fa-fw"></i></a><a href=javascript:void(0); title="Share on Facebook" data-sharer=facebook data-url=https://carrican.github.io/state-machine/ data-hashtag=Java><i class="fab fa-facebook-square fa-fw"></i></a><a href=javascript:void(0); title="Share on WhatsApp" data-sharer=whatsapp data-url=https://carrican.github.io/state-machine/ data-title="進入設計模式的世界 -- 狀態機模式 ( State pattern )" data-web><i class="fab fa-whatsapp fa-fw"></i></a><a href=javascript:void(0); title="Share on Line" data-sharer=line data-url=https://carrican.github.io/state-machine/ data-title="進入設計模式的世界 -- 狀態機模式 ( State pattern )"><i data-svg-src=/lib/simple-icons/icons/line.min.svg></i></a></span>
</div>
</div>
</div>
<div class=post-info-more>
<section class=post-tags><i class="fas fa-tags fa-fw"></i>&nbsp;<a href=/tags/java/>Java</a>,&nbsp;<a href=/tags/design/>Design</a>,&nbsp;<a href=/tags/pattern/>pattern</a>,&nbsp;<a href=/tags/state/>state</a>,&nbsp;<a href=/tags/machine/>machine</a>,&nbsp;<a href=/tags/transition/>transition</a></section>
<section>
<span><a href=javascript:void(0); onclick=window.history.back()>Back</a></span>&nbsp;|&nbsp;<span><a href=/>Home</a></span>
</section>
</div>
<div class=post-nav><a href=/two-pc-intro/ class=prev rel=prev title="跨伺服器交易處理 — 認識二階段提交 ( 2PC )"><i class="fas fa-angle-left fa-fw"></i>跨伺服器交易處理 — 認識二階段提交 ( 2PC )</a>
<a href=/aspectj/ class=next rel=next title="Intro to AOP & AspectJ">Intro to AOP & AspectJ<i class="fas fa-angle-right fa-fw"></i></a></div>
</div>
<div id=comments></div></article></div>
</main><footer class=footer>
<div class=footer-container><div class=footer-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2022</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=/ target=_blank>Darren</a></span><span class=icp-splitter>&nbsp;|&nbsp;</span><br class=icp-br>
<span class=icp>all right reserved.</span></div>
</div>
</footer></div>
<div id=fixed-buttons><a href=# id=back-to-top class=fixed-button title="Back to Top">
<i class="fas fa-arrow-up fa-fw"></i>
</a><a href=# id=view-comments class=fixed-button title="View Comments">
<i class="fas fa-comment fa-fw"></i>
</a>
</div><link rel=stylesheet href=/lib/katex/katex.min.css><link rel=stylesheet href=/lib/katex/copy-tex.min.css><link rel=stylesheet href=/lib/mermaid/mermaid.min.css><link rel=stylesheet href=/lib/cookieconsent/cookieconsent.min.css><script type=text/javascript src=/lib/smooth-scroll/smooth-scroll.min.js></script><script type=text/javascript src=/lib/autocomplete/autocomplete.min.js></script><script type=text/javascript src=/lib/lunr/lunr.min.js></script><script type=text/javascript src=/lib/lazysizes/lazysizes.min.js></script><script type=text/javascript src=/lib/clipboard/clipboard.min.js></script><script type=text/javascript src=/lib/sharer/sharer.min.js></script><script type=text/javascript src=/lib/katex/katex.min.js></script><script type=text/javascript src=/lib/katex/auto-render.min.js></script><script type=text/javascript src=/lib/katex/copy-tex.min.js></script><script type=text/javascript src=/lib/katex/mhchem.min.js></script><script type=text/javascript src=/lib/mermaid/mermaid.min.js></script><script type=text/javascript src=/lib/cookieconsent/cookieconsent.min.js></script><script type=text/javascript>window.config={code:{copyTitle:"Copy to clipboard",maxShownLines:200},comment:{},cookieconsent:{content:{dismiss:"Got it!",link:"Learn more",message:"This website uses Cookies to improve your experience."},enable:!0,palette:{button:{background:"#f0f0f0"},popup:{background:"#1aa3ff"}},theme:"edgeless"},data:{"id-1":"graph LR;\n    A([Draft]) --\u003e|Send to Boss| B([Waiting for Boss])\n    B --\u003e|Boss signed| C([Approved])","id-2":"graph LR;\n    A([Draft]) --\u003e|Send to Leader| B([Waiting for Leader])\n    B -.-\u003e|Leader rejects| A\n    B --\u003e|Send to Boss| C([Waiting for Boss])\n    C -.-\u003e|Boss rejects| B\n    C --\u003e|Boss signed| D([Approved])","id-3":"flowchart LR\n    A([Draft]) --\u003e RD-Hsinchu\n    subgraph RD-Hsinchu\n    C([Senior RD 1]) --\u003e D([Senior RD 2])\n    D --\u003e E([RD Manager])\n    end\n    RD-Hsinchu --\u003e PIE-Tainan\n    subgraph PIE-Tainan\n    F([Senior PIE]) --\u003e G([RE Manager])\n    end\nPIE-Tainan --\u003e K([Boss])\n    K --\u003e R([Approved])"},math:{delimiters:[{display:!0,left:"$$",right:"$$"},{display:!0,left:"\\[",right:"\\]"},{display:!1,left:"$",right:"$"},{display:!1,left:"\\(",right:"\\)"}],strict:!1},search:{highlightTag:"em",lunrIndexURL:"/index.json",maxResultLength:10,noResultsFound:"No results found",snippetLength:30,type:"lunr"}}</script><script type=text/javascript src=/js/theme.min.js></script></body>
</html>